{% extends "NzoTunisiefretBundle::layoutClient.html.twig" %}
{% block title %} {{ parent() }} Détails Demandes Export Postule {% endblock %}

{% block banner %}
<div class="jumbotron">
    <div class="col-md-4"> 
        <div class="row">
            <h4 class="title-banner" style="">Détails Demandes Export Postuler </h4>
        </div>
    </div>
</div>
{% endblock banner %}

{% block content %}
<div class="col-md-8 col-md-offset-2 well">
    <h4> Date De Postule: {{postule.datepostule|date("d/m/Y")}} </h4>
    <hr>
    {% if msgs|length <= 4 %}   
        {% for msg in msgs %} 
            <div class="panel panel-default" id="accordion">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        {%if msg.client != null %} Moi {%else%} {{msg.exportateur.prenom}} {{msg.exportateur.nom}} {%endif%}
                        <p class="pull-right">{{msg.date|date("d/m/Y H:i")}}</p>
                    </h3>
                </div>
                <div class="panel-body">
                    {{msg.message}}
                </div>
            </div>
        {% endfor %}    
    {% else %} 
    <div class="panel-group" id="accordion">
        <!-- First -->
        <div class="panel panel-info" style=" margin-bottom: 5px">
            <div class="panel-heading">
                <h3 class="panel-title">
                   {%if msgs|first.client != null %} Moi {%else%} {{msgs|first.exportateur.prenom}} {{msgs|first.exportateur.nom}} {%endif%}
                    <p class="pull-right">{{msgs|first.date|date("d/m/Y H:i")}}</p>
                </h3>
            </div>
            <div class="panel-body">
                 {{msgs|first.message}}
            </div>
        </div>
        <!-- BLOCK --> 
        <div id='nzolengthmsg' class="panel panel-warning" style=" margin-bottom: 5px">
            <div class="panel-heading">
                <h3 class="panel-title">
                    <span > {{msgs|length -2 }} Messages </span>
                </h3>
            </div>
        </div>
        <!-- Hidden FOR --> 
        <div id='nzoblockfor' style="display: none; margin-bottom: 5px">
            {% for msg in msgs %} 
            {% if msg != msgs|first and msg != msgs|last %}
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">
                        {%if msg.client != null %} Moi {%else%} {{msg.exportateur.prenom}} {{msg.exportateur.nom}} {%endif%}
                        <p class="pull-right">{{msg.date|date("d/m/Y H:i")}}</p>
                    </h3>
                </div>
                <div class="panel-body">
                     {{msg.message}}
                </div>
            </div>
            {% endif %}  
          {% endfor %}  
         </div>          
        <!-- Last -->
        <div class="panel panel-info">
            <div class="panel-heading">
                <h3 class="panel-title">
                    {%if msgs|last.client != null %} Moi {%else%} {{msgs|last.exportateur.prenom}} {{msgs|last.exportateur.nom}} {%endif%}
                    <p class="pull-right">{{msgs|last.date|date("d/m/Y H:i")}}</p>
                </h3>
            </div>
            <div class="panel-body">
                 {{msgs|last.message}}
            </div>
        </div>
        <!-- END Last -->     
    </div>       
    {% endif %}
    
    <form action="#" id="msgform" method="post" style="padding: 40px" role="form">
        <div class="form-group">
            <textarea id="nzomsgexp" required="required" class="form-control"></textarea>
        </div>
        <div class="buttons-set">
            <button type="submit" class="btn btn-primary pull-right">Envoyez</button>
        </div>
    </form>
</div>
{% endblock content %}
 
 {% block js %}  
    <script>
        $(document).ready(function(){
        
            $('#msgform').on('submit',function(c){
                c.preventDefault();
           
            if( $('#nzomsgexp').val() !== '' )             
            {
                $.ajax({
                    url:"{{ path('ajax_send_msg_client') }}",
                    type:"POST",
                    data:{ id:{{postule.id}}, msg:$('#nzomsgexp').val() },
                    dataType:'json',
                    success:function(a)
                    {
                        $('#nzomsgexp').val('');
                        var b='';
                        for(key in a)
                        {
                            b+=a[key]['user']+' | Date msg: '+a[key]['date']+' | '+a[key]['msg']+'<br>';
                        }
                        $('#accordion').html(b);
                    },
                    error:function()
                    {
                        alert('erreur');
                    }   
                });
            }
            else alert('champs vide!');
            
            });
            
           $('#nzolengthmsg').on('click',function(){ 
                $('#nzolengthmsg').remove();
                $('#nzoblockfor').show();
            });    
        });
    </script>

{% endblock js %}